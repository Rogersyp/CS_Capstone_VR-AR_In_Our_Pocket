<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>A-Frame - Room 1</title>
		<meta name="description" content="Room 1">
		<!-- Production Version, Minified -->
		<script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
		<!-- Development Version, Uncompressed with Source Maps 
		<script src="https://aframe.io/releases/0.5.0/aframe.js"></script>-->
		<style>
		body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; background-color: white;}
		</style>
	</head>
	<body>
		<a-scene id="scene" stats fog="type: linear; density: 1; far : 50; color: #AAA">
		
		<a-assets>
			<img id="sky" src="textures/sky.jpg">
			<img id="ground" src="textures/leaves_ground.jpg">
			<a-asset-item id="tree-obj" src="objects/tree2.obj"></a-asset-item>
			<a-asset-item id="tree-mtl" src="objects/tree.mtl"></a-asset-item>
		</a-assets>

		<a-entity position="0 1.8 6">
			<a-camera>
				<a-cursor color="#4CC3D9"></a-cursor>
			</a-camera>
		</a-entity>

		<a-sky height="2048" radius="30" src="#sky" theta-length="90" width="2048"></a-sky>

		<a-entity
			geometry="primitive: plane; width: 60; height: 60;"
			material="color:#c0c0c0; flatShading: true; shader: standard; side: front; src: #ground; repeat: 100 100" rotation="-90 0 0">
		</a-entity>

		<a-entity
			geometry="primitive:torusKnot;p:7;q:2;radius:2;segmentsRadial:8" 
			material="color:#8080FF" position="0 13 0" scale="2 2 2">
			<a-animation dur="10000" attribute="geometry.q" to="7"></a-animation>
			<a-animation delay="10000" dur="10000" attribute="geometry.p" to="2"></a-animation>
		</a-entity>


		<a-entity id="player" collider-check>
  		<a-entity raycaster="objects: .collidable" position="0 -0.9 0" rotation="90 0 0"></a-entity>
		</a-entity>
		<a-entity class="collidable" geometry="primitive: box" position="1 0 0"></a-entity>



		</a-scene>
		
		<script>

			/*AFRAME.registerComponent('collider-check', {
			  dependencies: ['raycaster'],
			  init: function () {
			    this.el.addEventListener('raycaster-intersected', function () {
			      console.log('Player hit something!');
			    });
			  }
			});
			*/
			var sceneEl = document.querySelector('a-scene');
			
			if (sceneEl.hasLoaded) {
				addElements();
				doAnimations();
			} else {
				sceneEl.addEventListener('loaded', addElements);
				sceneEl.addEventListener('animated', doAnimations);
			}
			
			function generateRand(min, max) {
				return Math.floor(Math.random() * (max - min) + min);
			}
			
			function addElements () {
				for (i = 0; i < 50; i++) { 
					var entityEl = document.createElement('a-entity');
					entityEl.setAttribute('obj-model', {
						obj: '#tree-obj',
						mtl: '#tree-mtl'
					});
					entityEl.setAttribute('scale', {
						x: 2,
						y: 2,
						z: 2
					});
					entityEl.setAttribute('position', {
						x: generateRand(-28,28),
						y: 3.8,
						z: generateRand(-28,28)
					});
                                        
					//entityEl.setAttribute('light', {
					 //       type: 'point',
					   //     color: '#424242',
						 //   intensity: .1                                       
					//});
                                         
					sceneEl.appendChild(entityEl);
				}
				
			};
				
			function doAnimations () {
			//var
			
			}
			
			var data = [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
  
			var hscale = d3.scale.linear()
				.domain([0, d3.max(data)])
				.range([0, 3])
    
			var scene = d3.select("a-scene")
			//https://github.com/d3/d3/blob/master/API.md
			// we use d3's enter/update/exit pattern to draw and bind our dom elements
			var circles = scene.selectAll("a-sphere.circles").data(data)
			circles.enter().append("a-sphere").classed("circles", true)
			//https://bl.ocks.org/enjalot/8be32e6f1f32920ba841
			
			circles.attr({
				position: function(d,i) {
					var y = 15;
					var radius = 15;
					var x = radius * Math.cos(i/data.length * 2 * Math.PI)
					var z = radius * Math.sin(i/data.length * 2 * Math.PI)
					return x + " " + y + " " + z
				},
				rotation: function(d,i) {
					var x = 0;
					var z = 0;
					var y = 0;
					//-(i/data.length)*360 not circle
					return x + " " + y + " " + z
				},
					radius: function(d) { return hscale(d)},
					depth: function(d) { return 0.9},
					height: function(d) { return 20},
					opacity: function(d,i) { return 0.6 + (i/data.length) * 0.4},
				})
				.on("click", function(d,i) {
					console.log("click", i,d)
					//do something
				})
				.on("mouseenter", function(d,i) {
					if(this.hovering) return;
					console.log("hover", i,d)
					this.hovering = true;
					d3.select(this).transition().duration(1000)
					.attr({
						metalness: 0.5,
						radius: 2,
						//rotation: 0 + " " + 100 + " " + 0
					})
				})
				.on("mouseleave", function(d,i) {
					console.log("leave",i,d)
					this.hovering = false;
					d3.select(this).transition()
					.attr({
						metalness: 0,
						radius: .5,
					})
				})
		</script>
	</body>
</html>
